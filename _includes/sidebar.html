{% if page.author_profile or layout.author_profile or page.sidebar %}
  <div class="sidebar sticky">
  {% if page.author_profile or layout.author_profile %}{% include author-profile.html %}{% endif %}
  {% if page.sidebar %}
    {% for s in page.sidebar %}
      {% if s.image %}
        <img src="{{ s.image | relative_url }}"
             alt="{% if s.image_alt %}{{ s.image_alt }}{% endif %}">
      {% endif %}
      {% if s.title %}<h3>{{ s.title }}</h3>{% endif %}
      {% if s.text %}{{ s.text | markdownify }}{% endif %}
      {% if s.nav %}{% include nav_list nav=s.nav %}{% endif %}
    {% endfor %}
    {% if page.sidebar.nav %}
      {% include nav_list nav=page.sidebar.nav %}
    {% endif %}
  {% endif %}

  <!-- 달력 위젯 -->
  <div class="sidebar__calendar" style="margin:2em 0; padding:1.2em; background:rgba(255,255,255,0.07); border-radius:12px;">
    <div style="font-weight:bold; font-size:1.1em; margin-bottom:0.5em; color:#c6aeff;">달력</div>
    <div id="calendar-widget"></div>
  </div>

  <!-- 방문자수 위젯 -->
  <div class="sidebar__counter" style="margin:2em 0; padding:1.2em; background:rgba(255,255,255,0.07); border-radius:12px;">
    <div style="font-weight:bold; font-size:1.1em; margin-bottom:0.5em; color:#c6aeff;">방문자 수</div>
    <div style="font-size:1.05em;">
      전체 <span id="visitor-total">5,862</span><br>
      오늘 <span id="visitor-today">0</span><br>
      어제 <span id="visitor-yesterday">10</span>
    </div>
  </div>
  </div>
{% endif %}

<script>
// 달력 위젯 (간단한 JS 렌더링)
(function() {
  const cal = document.getElementById('calendar-widget');
  if (!cal) return;
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const today = now.getDate();
  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month+1, 0).getDate();
  const weekDays = ['일','월','화','수','목','금','토'];
  let html = `<div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:0.3em;'>
    <button id='cal-prev' style='background:none;border:none;color:#9a43c6;font-size:1.1em;cursor:pointer;'>&lt;</button>
    <span style='font-weight:bold;'>${year}년 ${month+1}월</span>
    <button id='cal-next' style='background:none;border:none;color:#9a43c6;font-size:1.1em;cursor:pointer;'>&gt;</button>
  </div>`;
  html += `<table style='width:100%;text-align:center;font-size:0.98em;'><thead><tr>`;
  weekDays.forEach(d=>{html+=`<th style='color:#c6aeff;font-weight:600;'>${d}</th>`});
  html += `</tr></thead><tbody><tr>`;
  for(let i=0;i<firstDay;i++) html+='<td></td>';
  for(let d=1;d<=lastDate;d++){
    const isToday = d===today;
    html += `<td style='padding:2px 0;${isToday?"background:#c6aeff;color:#23243a;border-radius:6px;font-weight:bold;":''}'>${d}</td>`;
    if((firstDay+d)%7===0) html+='</tr><tr>';
  }
  html += '</tr></tbody></table>';
  cal.innerHTML = html;
  // 월 이동(간단, 실제 구현은 생략)
})();
// 방문자수(임시, 실제는 외부 서비스 필요)
document.getElementById('visitor-today').textContent = Math.floor(Math.random()*10+1);
document.getElementById('visitor-yesterday').textContent = Math.floor(Math.random()*10+1);
</script>
